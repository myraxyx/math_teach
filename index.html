<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Teacher RPG - Dreamy Classroom Adventure</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Quicksand:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background Elements */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 15s infinite linear;
            z-index: 0;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-1000px) rotate(360deg); }
        }

        /* Main Game Container */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(255, 150, 200, 0.4),
                        0 0 0 15px #ffb8d9,
                        0 0 0 25px #a6e3ff;
            overflow: hidden;
            position: relative;
            z-index: 1;
            border: 8px solid #ff9acd;
        }

        /* Header */
        .game-header {
            background: linear-gradient(90deg, #ffb8d9, #a6e3ff);
            color: #5a3d5c;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 8px dotted #ff9acd;
            position: relative;
        }

        .header-content {
            flex-grow: 1;
            text-align: center;
        }

        .game-title {
            font-family: 'Nunito', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: #5a3d5c;
            text-shadow: 3px 3px 0 #ffde59;
            margin-bottom: 10px;
        }

        .title-decoration {
            font-size: 2rem;
            color: #ff6ba9;
            animation: spin 4s infinite linear;
            display: inline-block;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .day-info {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .day-badge {
            background: linear-gradient(145deg, #ffde59, #ffb347);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 5px 0 #ff8a00;
            border: 4px solid white;
            transition: all 0.3s;
        }

        .day-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 0 #ff8a00;
        }

        .topic-badge {
            background: linear-gradient(145deg, #a6e3ff, #6bcbff);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 5px 0 #0099ff;
            border: 4px solid white;
            transition: all 0.3s;
        }

        .topic-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 0 #0099ff;
        }

        /* Main Game Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 25px;
            padding: 25px;
            min-height: 600px;
        }

        /* Classroom Section - Left */
        .classroom-section {
            background: linear-gradient(145deg, #fff9e6, #fff0cc);
            border-radius: 25px;
            padding: 20px;
            border: 6px solid #ffde59;
            box-shadow: 0 10px 30px rgba(255, 222, 89, 0.3);
            position: relative;
            overflow: hidden;
        }

        .classroom-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle at 10px 10px, #ffde59 2px, transparent 3px);
            background-size: 30px 30px;
            opacity: 0.1;
        }

        .section-title {
            font-family: 'Nunito', sans-serif;
            font-size: 1.8rem;
            color: #ff6ba9;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 4px dotted #ffde59;
            position: relative;
        }

        .section-title i {
            margin-right: 10px;
            animation: wiggle 2s infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        .student-container {
            display: grid;
            gap: 12px;
        }

        .student-card {
            background: white;
            padding: 15px;
            border-radius: 20px;
            border: 4px solid;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .student-card:hover {
            transform: translateX(10px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .student-card.asking {
            animation: studentQuestion 1s infinite;
            border-color: #6bcbff;
            background: linear-gradient(145deg, #e3f2ff, #bbdefb);
        }

        @keyframes studentQuestion {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .student-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffb8d9, #a6e3ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 3px solid white;
            box-shadow: 0 3px 0 #ff9acd;
        }

        .student-info {
            flex-grow: 1;
        }

        .student-name {
            font-weight: 700;
            color: #5a3d5c;
            font-size: 1.1rem;
        }

        .student-score {
            font-size: 0.9rem;
            color: #ff6ba9;
            font-weight: 600;
        }

        .student-status {
            font-size: 0.8rem;
            padding: 3px 10px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
        }

        .status-truant { background: #ff9800; }
        .status-bk { background: #4CAF50; }

        /* Whiteboard Section - Center */
        .whiteboard-section {
            background: linear-gradient(145deg, #2c3e50, #34495e);
            border-radius: 25px;
            padding: 25px;
            border: 8px solid #ffde59;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .whiteboard-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(90deg, transparent 98%, rgba(255,255,255,0.1) 100%),
                linear-gradient(0deg, transparent 98%, rgba(255,255,255,0.1) 100%);
            background-size: 50px 50px;
            opacity: 0.2;
        }

        .question-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            min-height: 150px;
            margin-bottom: 25px;
            border: 5px solid #ffde59;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.6;
            color: #2c3e50;
            font-weight: 600;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .answer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }

        .answer-card {
            background: rgba(255, 255, 255, 0.9);
            border: 5px solid #a6e3ff;
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .answer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.5s;
        }

        .answer-card:hover::before {
            left: 100%;
        }

        .answer-card:hover {
            transform: translateY(-5px) scale(1.05);
            background: white;
            border-color: #ff9acd;
            box-shadow: 0 10px 25px rgba(255, 154, 205, 0.4);
        }

        .answer-card.correct {
            background: linear-gradient(145deg, #4CAF50, #66BB6A);
            border-color: #2E7D32;
            color: white;
            animation: correctAnswer 0.5s ease;
        }

        .answer-card.incorrect {
            background: linear-gradient(145deg, #ff5252, #ff6b6b);
            border-color: #c62828;
            color: white;
            animation: shake 0.5s ease;
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Stats Section - Right */
        .stats-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-card {
            background: linear-gradient(145deg, #fff0f5, #ffe6ee);
            border-radius: 25px;
            padding: 20px;
            border: 6px solid;
            box-shadow: 0 8px 25px rgba(255, 182, 193, 0.3);
            transition: all 0.3s;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(255, 182, 193, 0.4);
        }

        .stats-card.ranking { border-color: #ffde59; }
        .stats-card.progress { border-color: #6bcbff; }
        .stats-card.teacher { border-color: #ff9acd; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9acd, #ff6ba9);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Ranking List Styles */
        .ranking-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 15px;
            border: 3px solid #ffde59;
            transition: all 0.3s;
            cursor: pointer;
        }

        .ranking-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ranking-position {
            font-weight: 700;
            color: #ff6ba9;
            font-size: 1.2rem;
            min-width: 30px;
            text-align: center;
        }

        .ranking-name {
            flex-grow: 1;
            padding-left: 15px;
            font-weight: 700;
            color: #5a3d5c;
            font-size: 1.1rem;
        }

        .ranking-score {
            font-weight: 700;
            color: #ff6ba9;
            font-size: 1.1rem;
            min-width: 50px;
            text-align: right;
        }

        /* Controls */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 25px;
            background: linear-gradient(145deg, #fff9e6, #fff0cc);
            border-top: 8px dotted #ffde59;
            position: relative;
            overflow: hidden;
        }

        .control-btn {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 180px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.2);
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 0 rgba(0, 0, 0, 0.2);
        }

        .control-btn:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        }

        .btn-start { 
            background: linear-gradient(145deg, #ff9acd, #ff6ba9);
            color: white;
            border: 5px solid #ff4081;
        }

        .btn-next { 
            background: linear-gradient(145deg, #6bcbff, #0099ff);
            color: white;
            border: 5px solid #0066cc;
        }

        .btn-help { 
            background: linear-gradient(145deg, #ffde59, #ffb347);
            color: white;
            border: 5px solid #ff8a00;
        }

        .btn-ask { 
            background: linear-gradient(145deg, #4CAF50, #66BB6A);
            color: white;
            border: 5px solid #2E7D32;
        }

        /* Overlays */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .overlay-content {
            background: linear-gradient(145deg, #fff9e6, #fff0cc);
            padding: 40px;
            border-radius: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 8px solid #ff9acd;
            box-shadow: 0 25px 60px rgba(255, 154, 205, 0.5);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Popup Styles */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(145deg, #fff9e6, #fff0cc);
            padding: 30px;
            border-radius: 25px;
            border: 8px solid #ff9acd;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            z-index: 1001;
            display: none;
            min-width: 400px;
            max-width: 500px;
            animation: popupAppear 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popupAppear {
            0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .popup-content {
            text-align: center;
            color: #5a3d5c;
        }

        .popup-title {
            font-family: 'Nunito', sans-serif;
            font-size: 1.8rem;
            color: #ff6ba9;
            margin-bottom: 20px;
        }

        .popup-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .popup-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .popup-btn-primary {
            background: linear-gradient(145deg, #ff9acd, #ff6ba9);
            color: white;
            border: 4px solid #ff4081;
        }

        .popup-btn-secondary {
            background: linear-gradient(145deg, #6bcbff, #0099ff);
            color: white;
            border: 4px solid #0066cc;
        }

        /* Floating Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 20px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            z-index: 1001;
            display: none;
            animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .notification.correct {
            background: linear-gradient(145deg, #4CAF50, #66BB6A);
            border: 5px solid #2E7D32;
        }

        .notification.incorrect {
            background: linear-gradient(145deg, #ff5252, #ff6b6b);
            border: 5px solid #c62828;
        }

        /* Interactive Elements */
        .clickable {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .clickable:hover {
            transform: scale(1.1);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .day-info {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .answer-grid {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .popup {
                min-width: 300px;
                max-width: 90%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background Bubbles -->
    <div id="bubbles"></div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Start Day Popup -->
    <div class="popup" id="startDayPopup">
        <div class="popup-content">
            <h2 class="popup-title" id="startDayTitle">Mulai Hari 1</h2>
            <div class="popup-message" id="startDayMessage">
                Siap untuk memulai pelajaran hari ini? Mari kita ajarkan matematika dengan menyenangkan! ‚ú®
            </div>
            <div class="popup-buttons">
                <button class="popup-btn popup-btn-primary" onclick="startDayConfirmed()">Mulai Hari</button>
                <button class="popup-btn popup-btn-secondary" onclick="closePopup('startDayPopup')">Nanti</button>
            </div>
        </div>
    </div>

    <!-- Student Question Popup -->
    <div class="popup" id="studentQuestionPopup">
        <div class="popup-content">
            <h2 class="popup-title">Pertanyaan Siswa</h2>
            <div class="popup-message" id="studentQuestionMessage">
                <!-- Student question message will be added here -->
            </div>
            <div class="popup-buttons">
                <button class="popup-btn popup-btn-primary" onclick="answerStudentQuestionPopup()">Jawab Pertanyaan</button>
                <button class="popup-btn popup-btn-secondary" onclick="closeStudentQuestionPopup()">Lewati</button>
            </div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <div class="header-content">
                <h1 class="game-title">
                    <span class="title-decoration">‚ú®</span>
                    Math Teacher Adventure
                    <span class="title-decoration">üéì</span>
                </h1>
                
                <div class="day-info">
                    <div class="day-badge" id="dayCounter">
                        üìÖ Hari <span id="dayNumber">1</span>/4
                    </div>
                    <div class="topic-badge" id="topicDisplay">
                        üìö Permutasi & Kombinasi
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Game Grid -->
        <div class="main-grid">
            <!-- Left: Classroom -->
            <div class="classroom-section">
                <h2 class="section-title"><i class="fas fa-user-graduate"></i> Siswa Kelas</h2>
                <div class="student-container" id="studentList">
                    <!-- Students will be dynamically added -->
                </div>
            </div>

            <!-- Center: Whiteboard -->
            <div class="whiteboard-section">
                <!-- Timer and Progress -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div class="day-badge" style="font-size: 1rem;" id="questionCounter">
                        ‚ùì Pertanyaan 1/10
                    </div>
                    <div class="day-badge" style="font-size: 1rem; background: linear-gradient(145deg, #ff5252, #ff6b6b);" id="timer">
                        ‚è∞ 25s
                    </div>
                </div>

                <!-- Question Display -->
                <div class="question-display">
                    <p class="question-text" id="questionText">
                        Selamat datang di petualangan mengajar! Klik tombol "Mulai Hari" di popup untuk memulai pelajaran hari ini. ‚ú®
                    </p>
                </div>

                <!-- Answer Options -->
                <div class="answer-grid" id="answerOptions">
                    <!-- Answers will be dynamically added -->
                </div>

                <!-- Progress Bars -->
                <div style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: white; font-weight: 600;">üòä Kesabaran Guru</span>
                        <span style="color: white; font-weight: 600;" id="patienceValue">100%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="patienceBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <!-- Right: Stats -->
            <div class="stats-section">
                <!-- Ranking Card -->
                <div class="stats-card ranking">
                    <h2 class="section-title"><i class="fas fa-trophy"></i> Ranking Siswa</h2>
                    <div id="rankingList">
                        <!-- Ranking will be dynamically added -->
                    </div>
                </div>

                <!-- Progress Card -->
                <div class="stats-card progress">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Progress Belajar</h2>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>üéØ Total Benar</span>
                            <span id="totalCorrectDisplay">0/20</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="correctnessBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                        <div style="text-align: center; padding: 10px; background: #ffde59; border-radius: 15px;">
                            <div style="font-size: 1.5rem; font-weight: 700;" id="averageScore">0%</div>
                            <div style="font-size: 0.9rem;">Rata-rata</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #a6e3ff; border-radius: 15px;">
                            <div style="font-size: 1.5rem; font-weight: 700;" id="teacherScore">0</div>
                            <div style="font-size: 0.9rem;">Skor Guru</div>
                        </div>
                    </div>
                </div>

                <!-- Teacher Stats Card -->
                <div class="stats-card teacher">
                    <h2 class="section-title"><i class="fas fa-chalkboard-teacher"></i> Status Guru</h2>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: #ffde59; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                ‚≠ê
                            </div>
                            <div>
                                <div style="font-weight: 600;">Semangat</div>
                                <div style="font-size: 1.2rem; font-weight: 700;" id="moraleValue">100</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; background: #ff9acd; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                üí™
                            </div>
                            <div>
                                <div style="font-weight: 600;">Status</div>
                                <div style="font-size: 1.2rem; font-weight: 700;" id="teacherStatus">Baik</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls - Only Bantuan Button -->
        <div class="game-controls">
            <button class="control-btn btn-help" onclick="showHelp()">
                <i class="fas fa-question-circle"></i> Bantuan
            </button>
        </div>
    </div>

    <!-- Material Overlay -->
    <div class="overlay" id="materialOverlay">
        <div class="overlay-content">
            <h2 style="text-align: center; color: #ff6ba9; margin-bottom: 20px;" id="materialTitle">
                üìö Materi Hari 1
            </h2>
            <div id="materialContent" style="color: #5a3d5c; line-height: 1.6; font-size: 1.1rem;">
                <!-- Material content will be added here -->
            </div>
            <button class="control-btn btn-start" onclick="continueToQuestions()" style="width: 100%; margin-top: 30px;">
                <i class="fas fa-arrow-right"></i> Mulai Belajar!
            </button>
        </div>
    </div>

    <!-- Student Question Detail Overlay -->
    <div class="overlay" id="studentQuestionDetailOverlay">
        <div class="overlay-content">
            <h2 style="text-align: center; color: #6bcbff; margin-bottom: 20px;">
                <i class="fas fa-question-circle"></i> Pertanyaan Siswa
            </h2>
            <div id="studentQuestionContent" style="background: #e3f2ff; padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                <!-- Student question will be added here -->
            </div>
            <div id="studentQuestionOptions" style="display: grid; gap: 15px; margin-bottom: 25px;">
                <!-- Options will be added here -->
            </div>
            <button class="control-btn btn-next" onclick="closeStudentQuestionDetail()" style="width: 100%;">
                <i class="fas fa-arrow-left"></i> Kembali ke Pelajaran
            </button>
        </div>
    </div>

    <!-- Day Complete Overlay -->
    <div class="overlay" id="dayCompleteOverlay">
        <div class="overlay-content">
            <h2 style="text-align: center; color: #4CAF50; margin-bottom: 25px;">
                üéâ Hari Selesai!
            </h2>
            <div style="background: linear-gradient(145deg, #e8f5e9, #c8e6c9); padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                <h3 style="color: #2E7D32; margin-bottom: 15px;">üìä Hasil Hari Ini:</h3>
                <div style="display: grid; gap: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>‚úÖ Jawaban Benar:</span>
                        <span id="dayCorrectAnswers" style="font-weight: 700;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>üìä Total Benar:</span>
                        <span id="totalCorrectSoFar" style="font-weight: 700;">0/20</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>üéØ Skor Hari:</span>
                        <span id="dayScore" style="font-weight: 700;">0</span>
                    </div>
                </div>
            </div>
            <button class="control-btn btn-next-day" onclick="autoNextDay()" style="width: 100%;">
                <i class="fas fa-arrow-right"></i> Lanjut ke Hari Berikutnya
            </button>
        </div>
    </div>

    <!-- Exam Overlay -->
    <div class="overlay" id="examOverlay">
        <div class="overlay-content">
            <h2 style="text-align: center; color: #ff6ba9; margin-bottom: 25px;">
                üéì UJIAN NASIONAL - Hari 4
            </h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                <div style="background: linear-gradient(145deg, #e8f5e9, #c8e6c9); padding: 20px; border-radius: 20px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 900; color: #2E7D32;" id="examAvgScore">0.0</div>
                    <div style="color: #2E7D32;">Rata-rata</div>
                </div>
                <div style="background: linear-gradient(145deg, #fff3e0, #ffe0b2); padding: 20px; border-radius: 20px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 900; color: #EF6C00;" id="examPassRate">0%</div>
                    <div style="color: #EF6C00;">Kelulusan</div>
                </div>
                <div style="background: linear-gradient(145deg, #ffebee, #ffcdd2); padding: 20px; border-radius: 20px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 900; color: #C62828;" id="examRisk">0%</div>
                    <div style="color: #C62828;">Risiko</div>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="control-btn btn-start" onclick="finishExam()" style="min-width: 200px;">
                    <i class="fas fa-flag-checkered"></i> Selesaikan Ujian
                </button>
            </div>
        </div>
    </div>

    <!-- Final Result Overlay -->
    <div class="overlay" id="resultOverlay">
        <div class="overlay-content">
            <h2 style="text-align: center; color: #ff6ba9; margin-bottom: 25px;" id="resultTitle">
                üéÆ Permainan Selesai!
            </h2>
            <div id="resultContent" style="text-align: center; color: #5a3d5c; font-size: 1.1rem; line-height: 1.6;">
                <!-- Result content will be added here -->
            </div>
            <div style="display: flex; gap: 20px; margin-top: 30px;">
                <button class="control-btn btn-start" onclick="restartGame()" style="flex: 1;">
                    <i class="fas fa-redo"></i> Main Lagi
                </button>
                <button class="control-btn btn-help" onclick="showHighScores()" style="flex: 1;">
                    <i class="fas fa-trophy"></i> Skor Tertinggi
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========================
        // GAME STATE & VARIABLES
        // ========================
        const gameState = {
            currentDay: 1,
            currentQuestion: 0,
            gameActive: false,
            timerActive: false,
            timeLeft: 25,
            timerInterval: null,
            autoNextTimer: null,
            questionsAnswered: 0,
            correctAnswers: 0,
            totalCorrectAllDays: 0,
            totalQuestionsAllDays: 0,
            patience: 100,
            teacherScore: 0,
            studentQuestionActive: false,
            askingStudent: null,
            studentQuestionsAnswered: 0,
            examActive: false,
            morale: 100,
            riskLevel: 30,
            requiredCorrect: 12,
            warningThreshold: 8,
            perfectBonus: 18,
            studentQuestionChance: 0.4, // Meningkatkan peluang siswa bertanya dari 0.3 ke 0.4
            studentQuestionCount: 0
        };

        // Students data
        const students = [
            { name: "Wemmbu", emoji: "üêª", color: "#FFB347" },
            { name: "Spoke", emoji: "üö¥", color: "#6BCBFF" },
            { name: "Parrotx2", emoji: "ü¶ú", color: "#4CAF50" },
            { name: "Gojo", emoji: "üëì", color: "#9C27B0" },
            { name: "Geto", emoji: "üé≠", color: "#795548" },
            { name: "Flame", emoji: "üî•", color: "#FF5252" }
        ];

        const studentScores = {};
        students.forEach(student => {
            studentScores[student.name] = 4.0 + Math.random() * 1.5;
        });

        // High scores
        let highScore = localStorage.getItem('mathTeacherHighScore') || 0;
        let bestCorrect = localStorage.getItem('mathTeacherBestCorrect') || 0;

        // ========================
        // GAME DATA - DIPERBARUI DENGAN 10 SOAL HARI 1
        // ========================
        const questionsData = {
            day1: [
                // SOAL PERMUTASI (5 soal)
                {
                    question: "Berapa banyak cara menyusun 5 buku berbeda di rak?",
                    options: ["24", "120", "720", "5040"],
                    correct: 1,
                    explanation: "Permutasi 5 objek: 5! = 5√ó4√ó3√ó2√ó1 = 120 cara",
                    type: "permutasi"
                },
                {
                    question: "Dalam lomba lari 8 peserta, berapa banyak kemungkinan juara 1, 2, dan 3?",
                    options: ["56", "336", "672", "40320"],
                    correct: 1,
                    explanation: "P(8,3) = 8√ó7√ó6 = 336 cara",
                    type: "permutasi"
                },
                {
                    question: "Password 4 digit dengan angka berbeda (0-9), berapa kemungkinan?",
                    options: ["10000", "5040", "3024", "720"],
                    correct: 1,
                    explanation: "10√ó9√ó8√ó7 = 5040 kemungkinan",
                    type: "permutasi"
                },
                {
                    question: "Berapa banyak cara menyusun huruf-huruf dalam kata 'MATEMATIKA'?",
                    options: ["151200", "30240", "90720", "453600"],
                    correct: 0,
                    explanation: "10!/(2!2!2!) = 151200 cara (ada 3 huruf yang berulang: M, A, T)",
                    type: "permutasi"
                },
                {
                    question: "Ada 7 warna berbeda untuk pelangi, berapa cara menyusun 3 warna pertama?",
                    options: ["210", "35", "840", "5040"],
                    correct: 0,
                    explanation: "P(7,3) = 7√ó6√ó5 = 210 cara",
                    type: "permutasi"
                },
                
                // SOAL KOMBINASI (5 soal)
                {
                    question: "Dari 10 siswa, berapa cara memilih 3 siswa untuk jadi panitia?",
                    options: ["30", "120", "720", "604800"],
                    correct: 1,
                    explanation: "Kombinasi C(10,3) = 120 cara",
                    type: "kombinasi"
                },
                {
                    question: "Dari 8 titik pada lingkaran, berapa banyak segitiga yang dapat dibentuk?",
                    options: ["56", "336", "672", "40320"],
                    correct: 0,
                    explanation: "C(8,3) = 56 segitiga",
                    type: "kombinasi"
                },
                {
                    question: "Dalam satu kelas ada 15 siswa. Berapa cara memilih 2 siswa untuk jadi ketua dan wakil?",
                    options: ["105", "210", "420", "30"],
                    correct: 1,
                    explanation: "C(15,2) √ó 2! = 105 √ó 2 = 210 cara (karena urutan penting)",
                    type: "kombinasi"
                },
                {
                    question: "Dari 12 pemain basket, berapa cara memilih 5 pemain starter?",
                    options: ["792", "95040", "665280", "479001600"],
                    correct: 0,
                    explanation: "C(12,5) = 792 cara",
                    type: "kombinasi"
                },
                {
                    question: "Ada 6 jenis buah di toko. Berapa cara memilih 3 jenis buah berbeda?",
                    options: ["20", "120", "720", "216"],
                    correct: 0,
                    explanation: "C(6,3) = 20 cara",
                    type: "kombinasi"
                }
            ],
            day2: [
                {
                    question: "Peluang muncul angka genap pada dadu?",
                    options: ["1/6", "1/3", "1/2", "2/3"],
                    correct: 2,
                    explanation: "Angka genap: 2,4,6 ‚Üí 3/6 = 1/2"
                },
                {
                    question: "Dua koin dilempar, peluang satu gambar satu angka?",
                    options: ["1/4", "1/3", "1/2", "3/4"],
                    correct: 2,
                    explanation: "Kemungkinan: AA, AG, GA, GG ‚Üí 2/4 = 1/2"
                },
                {
                    question: "Dari 52 kartu, peluang dapat AS?",
                    options: ["1/13", "1/4", "1/52", "4/52"],
                    correct: 0,
                    explanation: "Ada 4 AS dari 52 kartu = 4/52 = 1/13"
                }
            ],
            day3: [
                {
                    question: "lim (x¬≤-4)/(x-2) saat x‚Üí2?",
                    options: ["0", "2", "4", "Tak terhingga"],
                    correct: 2,
                    explanation: "(x-2)(x+2)/(x-2) = x+2 ‚Üí 4"
                },
                {
                    question: "lim sin(x)/x saat x‚Üí0?",
                    options: ["0", "1", "Tak terhingga", "Tidak ada"],
                    correct: 1,
                    explanation: "Limit trigonometri dasar = 1"
                },
                {
                    question: "lim (3x¬≤ + 2x - 1) saat x‚Üí1?",
                    options: ["2", "3", "4", "5"],
                    correct: 2,
                    explanation: "3(1)¬≤ + 2(1) - 1 = 4"
                }
            ]
        };

        // Fungsi untuk mengacak urutan soal
        function shuffleQuestions() {
            // Acak semua soal di hari 1
            const day1Questions = [...questionsData.day1];
            for (let i = day1Questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [day1Questions[i], day1Questions[j]] = [day1Questions[j], day1Questions[i]];
            }
            questionsData.day1 = day1Questions;
        }

        const materialData = {
            day1: {
                title: "üìö Hari 1: Permutasi & Kombinasi",
                content: `
                    <div style="background: linear-gradient(145deg, #e3f2ff, #bbdefb); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h3 style="color: #1976D2; margin-bottom: 10px;">‚ú® Apa itu Permutasi?</h3>
                        <p>Permutasi adalah cara menyusun objek dengan <strong>memperhatikan urutan</strong>.</p>
                        <p>Contoh: Susunan juara 1, 2, 3 dalam lomba lari.</p>
                        <p><strong>Rumus:</strong> P(n,r) = n! / (n-r)!</p>
                        <p><strong>Contoh Soal:</strong> Berapa cara menyusun 3 buku dari 5 buku berbeda?</p>
                        <p>Jawab: P(5,3) = 5√ó4√ó3 = 60 cara</p>
                    </div>
                    <div style="background: linear-gradient(145deg, #e8f5e9, #c8e6c9); padding: 20px; border-radius: 15px;">
                        <h3 style="color: #2E7D32; margin-bottom: 10px;">‚ú® Apa itu Kombinasi?</h3>
                        <p>Kombinasi adalah cara memilih objek <strong>tanpa memperhatikan urutan</strong>.</p>
                        <p>Contoh: Memilih 3 siswa untuk jadi panitia.</p>
                        <p><strong>Rumus:</strong> C(n,r) = n! / [r!(n-r)!]</p>
                        <p><strong>Contoh Soal:</strong> Berapa cara memilih 3 siswa dari 10 siswa?</p>
                        <p>Jawab: C(10,3) = 120 cara</p>
                    </div>
                    <div style="background: linear-gradient(145deg, #fff0f5, #ffe6ee); padding: 20px; border-radius: 15px; margin-top: 20px;">
                        <h3 style="color: #ff6ba9; margin-bottom: 10px;">üí° Tips Membedakan:</h3>
                        <p>üîπ <strong>Permutasi:</strong> "Susunan", "urutan", "juara 1,2,3", "password"</p>
                        <p>üîπ <strong>Kombinasi:</strong> "Memilih", "panitia", "komite", "tim"</p>
                        <p>üîπ Jika urutan penting ‚Üí <strong>Permutasi</strong></p>
                        <p>üîπ Jika urutan tidak penting ‚Üí <strong>Kombinasi</strong></p>
                    </div>
                `
            },
            day2: {
                title: "üìö Hari 2: Peluang (Probability)",
                content: `
                    <div style="background: linear-gradient(145deg, #fff3e0, #ffe0b2); padding: 20px; border-radius: 15px;">
                        <h3 style="color: #EF6C00; margin-bottom: 10px;">‚ú® Mengenal Peluang</h3>
                        <p>Peluang mengukur kemungkinan suatu kejadian terjadi.</p>
                        <p><strong>Nilai:</strong> 0 (mustahil) hingga 1 (pasti).</p>
                        <p><strong>Rumus:</strong> P(A) = n(A) / n(S)</p>
                        <p>n(A) = hasil yang diinginkan</p>
                        <p>n(S) = total kemungkinan</p>
                    </div>
                `
            },
            day3: {
                title: "üìö Hari 3: Limit Fungsi",
                content: `
                    <div style="background: linear-gradient(145deg, #f3e5f5, #e1bee7); padding: 20px; border-radius: 15px;">
                        <h3 style="color: #7B1FA2; margin-bottom: 10px;">‚ú® Konsep Limit</h3>
                        <p>Limit menunjukkan nilai yang didekati oleh fungsi saat variabel mendekati nilai tertentu.</p>
                        <p><strong>Notasi:</strong> lim f(x) = L</p>
                        <p>x‚Üíc</p>
                        <p>Artinya: saat x mendekati c, f(x) mendekati L</p>
                    </div>
                `
            }
        };

        // ========================
        // GAME INITIALIZATION
        // ========================
        function initGame() {
            // Acak soal sebelum memulai
            shuffleQuestions();
            
            createBubbles();
            updateUI();
            updateStudentList();
            updateRanking();
            
            // Set initial progress bars
            updateProgressBars();
            
            // Show welcome message
            setTimeout(() => {
                showNotification("Selamat datang di Math Teacher Adventure! ‚ú®", "correct");
                // Show start day popup automatically
                setTimeout(() => {
                    showStartDayPopup();
                }, 1500);
            }, 1000);
        }

        function createBubbles() {
            const bubblesContainer = document.getElementById('bubbles');
            const colors = ['#ffb8d9', '#a6e3ff', '#ffde59', '#ff9acd', '#6bcbff'];
            
            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                const size = Math.random() * 100 + 50;
                const left = Math.random() * 100;
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${left}%`;
                bubble.style.top = `120%`;
                bubble.style.background = color;
                bubble.style.animationDelay = `${Math.random() * 15}s`;
                bubble.style.opacity = Math.random() * 0.3 + 0.1;
                
                bubblesContainer.appendChild(bubble);
            }
        }

        // ========================
        // POPUP FUNCTIONS
        // ========================
        function showStartDayPopup() {
            const topics = ["Permutasi & Kombinasi", "Peluang", "Limit Fungsi", "UJIAN NASIONAL"];
            const topic = topics[gameState.currentDay - 1];
            
            document.getElementById('startDayTitle').textContent = `Mulai Hari ${gameState.currentDay}`;
            
            let message = `
                <p>‚ú® <strong>Hari ${gameState.currentDay}: ${topic}</strong> ‚ú®</p>
                <p>Siap untuk memulai pelajaran hari ini?</p>
                <p>Mari kita ajarkan matematika dengan menyenangkan! üéì</p>
            `;
            
            if (gameState.currentDay === 1) {
                message += `
                    <p><strong>üìä Hari ini ada 10 soal:</strong></p>
                    <p>‚Ä¢ 5 soal Permutasi</p>
                    <p>‚Ä¢ 5 soal Kombinasi</p>
                    <p>Soal akan muncul secara acak!</p>
                `;
            }
            
            if (gameState.currentDay === 4) {
                message += '<p><strong>‚ö†Ô∏è PERINGATAN:</strong> Ini adalah hari Ujian Nasional!</p>';
            }
            
            document.getElementById('startDayMessage').innerHTML = message;
            
            document.getElementById('startDayPopup').style.display = 'block';
        }

        function closePopup(popupId) {
            document.getElementById(popupId).style.display = 'none';
        }

        function startDayConfirmed() {
            closePopup('startDayPopup');
            
            if (gameState.currentDay === 4) {
                startExamDay();
                return;
            }
            
            showMaterial();
        }

        function showStudentQuestionPopup() {
            if (!gameState.askingStudent) return;
            
            const student = students.find(s => s.name === gameState.askingStudent);
            
            document.getElementById('studentQuestionMessage').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;">
                    <div style="width: 60px; height: 60px; background: ${student.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px;">
                        ${student.emoji}
                    </div>
                    <div>
                        <h3 style="margin: 0; color: ${student.color};">${student.name}</h3>
                    </div>
                </div>
                <p><strong>${student.name}</strong> memiliki pertanyaan untuk Anda!</p>
                <p>Klik "Jawab Pertanyaan" untuk membantu ${student.name} memahami materi.</p>
                <p style="color: #ff6ba9; font-weight: 600;">‚è∞ Anda punya 10 detik untuk merespon!</p>
            `;
            
            document.getElementById('studentQuestionPopup').style.display = 'block';
            
            // Auto close after 10 seconds
            setTimeout(() => {
                if (document.getElementById('studentQuestionPopup').style.display === 'block') {
                    gameState.patience -= 10;
                    gameState.studentQuestionCount++;
                    showNotification(`üòî ${student.name} kecewa tidak ditanggapi! -10 Kesabaran`, "incorrect");
                    closeStudentQuestionPopup();
                }
            }, 10000);
        }

        function answerStudentQuestionPopup() {
            closePopup('studentQuestionPopup');
            answerStudentQuestion();
        }

        function closeStudentQuestionPopup() {
            closePopup('studentQuestionPopup');
            gameState.studentQuestionActive = false;
            gameState.askingStudent = null;
            updateStudentList();
            
            if (gameState.gameActive) {
                startTimer();
            }
        }

        // ========================
        // GAME CORE FUNCTIONS
        // ========================
        function showMaterial() {
            const material = materialData[`day${gameState.currentDay}`];
            document.getElementById('materialTitle').textContent = material.title;
            document.getElementById('materialContent').innerHTML = material.content;
            document.getElementById('materialOverlay').style.display = 'flex';
        }

        function continueToQuestions() {
            document.getElementById('materialOverlay').style.display = 'none';
            
            gameState.gameActive = true;
            gameState.currentQuestion = 0;
            gameState.timeLeft = 25;
            gameState.studentQuestionCount = 0; // Reset counter pertanyaan siswa
            
            showQuestion();
            startTimer();
            
            // Show first question notification
            showNotification("Pertanyaan pertama! Jawab dengan cermat! üí´", "correct");
        }

        function showQuestion() {
            if (!gameState.gameActive) return;
            
            const questions = questionsData[`day${gameState.currentDay}`];
            if (!questions || gameState.currentQuestion >= questions.length) {
                endDay();
                return;
            }
            
            const question = questions[gameState.currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `‚ùì Pertanyaan ${gameState.currentQuestion + 1}/${questions.length}`;
            
            const answerOptions = document.getElementById('answerOptions');
            answerOptions.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const answerCard = document.createElement('div');
                answerCard.className = 'answer-card clickable';
                answerCard.textContent = option;
                answerCard.onclick = () => checkAnswer(index);
                answerOptions.appendChild(answerCard);
            });
            
            updateUI();
        }

        function checkAnswer(selectedIndex) {
            const questions = questionsData[`day${gameState.currentDay}`];
            const question = questions[gameState.currentQuestion];
            const answerCards = document.querySelectorAll('.answer-card');
            
            answerCards.forEach(card => card.style.pointerEvents = 'none');
            stopTimer();
            
            const isCorrect = selectedIndex === question.correct;
            
            answerCards.forEach((card, index) => {
                if (index === question.correct) {
                    card.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    card.classList.add('incorrect');
                }
            });
            
            gameState.questionsAnswered++;
            gameState.totalQuestionsAllDays++;
            
            if (isCorrect) {
                gameState.correctAnswers++;
                gameState.totalCorrectAllDays++;
                gameState.teacherScore += 15;
                gameState.patience = Math.min(100, gameState.patience + 5);
                
                // Tampilkan notifikasi dengan informasi soal
                const questionType = question.type ? ` (${question.type.charAt(0).toUpperCase() + question.type.slice(1)})` : '';
                showNotification(`üéâ Jawaban Benar${questionType}! +15 Poin`, "correct");
                
                // Add sparkle effect to correct answer
                const correctCard = answerCards[question.correct];
                correctCard.innerHTML += ' ‚ú®';
            } else {
                gameState.patience -= 25;
                if (gameState.patience <= 0) gameState.patience = 0;
                
                showNotification(`üò¢ Jawaban Salah! -25 Kesabaran`, "incorrect");
            }
            
            updateUI();
            updateProgressBars();
            
            clearTimeout(gameState.autoNextTimer);
            gameState.autoNextTimer = setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            gameState.timeLeft = 25;
            
            showQuestion();
            startTimer();
            
            // Enable answer cards
            document.querySelectorAll('.answer-card').forEach(card => {
                card.style.pointerEvents = 'auto';
                card.classList.remove('correct', 'incorrect');
            });
            
            // Random student question chance - DITINGKATKAN
            // Siswa lebih sering bertanya, terutama jika sudah menjawab beberapa soal
            let chance = gameState.studentQuestionChance;
            
            // Tambah peluang jika sudah banyak soal dijawab
            if (gameState.currentQuestion >= 3) {
                chance += 0.1;
            }
            
            // Tambah peluang jika belum banyak siswa bertanya hari ini
            if (gameState.studentQuestionCount < 2) {
                chance += 0.15;
            }
            
            // Pastikan peluang tidak lebih dari 0.7 (70%)
            chance = Math.min(0.7, chance);
            
            if (Math.random() < chance) {
                triggerStudentQuestion();
            }
        }

        function startTimer() {
            if (gameState.timerActive) return;
            
            gameState.timerActive = true;
            gameState.timeLeft = 25;
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = `‚è∞ ${gameState.timeLeft}s`;
                
                // Color warning when time is low
                if (gameState.timeLeft <= 10) {
                    document.getElementById('timer').style.background = 'linear-gradient(145deg, #ff5252, #ff6b6b)';
                }
                
                if (gameState.timeLeft <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timerActive = false;
        }

        function timeUp() {
            stopTimer();
            gameState.patience -= 20;
            showNotification("‚è∞ Waktu habis! -20 Kesabaran", "incorrect");
            
            const answerCards = document.querySelectorAll('.answer-card');
            answerCards.forEach(card => card.style.pointerEvents = 'none');
            
            clearTimeout(gameState.autoNextTimer);
            gameState.autoNextTimer = setTimeout(() => {
                nextQuestion();
            }, 2000);
            
            updateUI();
            updateProgressBars();
        }

        // ========================
        // STUDENT INTERACTIONS - DITINGKATKAN FREKUENSINYA
        // ========================
        function updateStudentList() {
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'student-card clickable';
                
                if (gameState.askingStudent === student.name) {
                    studentCard.classList.add('asking');
                }
                
                studentCard.innerHTML = `
                    <div class="student-avatar" style="background: ${student.color}">
                        ${student.emoji}
                    </div>
                    <div class="student-info">
                        <div class="student-name">${student.name}</div>
                        <div class="student-score">Pemahaman: ${studentScores[student.name].toFixed(1)}K</div>
                    </div>
                `;
                
                studentCard.onclick = () => {
                    if (gameState.askingStudent === student.name) {
                        closePopup('studentQuestionPopup');
                        answerStudentQuestion();
                    } else {
                        showNotification(`üëã Hai ${student.name}! Pemahaman: ${studentScores[student.name].toFixed(1)}K`, "correct");
                    }
                };
                
                studentList.appendChild(studentCard);
            });
        }

        function triggerStudentQuestion() {
            if (!gameState.gameActive || gameState.studentQuestionActive) return;
            
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            gameState.askingStudent = randomStudent.name;
            gameState.studentQuestionActive = true;
            gameState.studentQuestionCount++;
            
            updateStudentList();
            
            // Show student question popup
            showStudentQuestionPopup();
            stopTimer();
            
            // Juga tambah notifikasi
            showNotification(`${randomStudent.emoji} ${randomStudent.name} ingin bertanya!`, "correct");
        }

        function answerStudentQuestion() {
            if (!gameState.askingStudent) return;
            
            const student = students.find(s => s.name === gameState.askingStudent);
            
            // Create questions based on current day and question type
            let question, options, correct;
            const currentQuestion = questionsData[`day${gameState.currentDay}`][gameState.currentQuestion];
            const questionType = currentQuestion?.type || "umum";
            
            if (gameState.currentDay === 1) {
                // Pertanyaan khusus untuk permutasi dan kombinasi
                if (questionType === "permutasi") {
                    question = "Pak, apa bedanya permutasi dan kombinasi?";
                    options = [
                        "Permutasi memperhatikan urutan, kombinasi tidak",
                        "Kombinasi untuk memilih, permutasi untuk menyusun",
                        "Permutasi menggunakan faktorial, kombinasi tidak",
                        "Tidak ada bedanya, sama saja"
                    ];
                    correct = 0;
                } else if (questionType === "kombinasi") {
                    question = "Pak, kapan kita menggunakan kombinasi?";
                    options = [
                        "Saat memilih panitia tanpa urutan",
                        "Saat menentukan juara lomba",
                        "Saat menyusun password",
                        "Saat menghitung peluang dadu"
                    ];
                    correct = 0;
                } else {
                    question = "Pak, saya kurang paham dengan materi ini...";
                    options = ["Saya akan jelaskan lagi", "Pelajari sendiri", "Tanya teman", "Lewati saja"];
                    correct = 0;
                }
            } else if (gameState.currentDay === 2) {
                question = "Pak, kenapa peluang selalu antara 0 dan 1?";
                options = ["Karena definisi probabilitas", "Agar mudah dihitung", "Kebiasaan saja", "Bisa lebih dari 1"];
                correct = 0;
            } else if (gameState.currentDay === 3) {
                question = "Pak, apa artinya limit tak hingga?";
                options = ["Nilai semakin besar tanpa batas", "Tidak terdefinisi", "Sama dengan 0", "Hasilnya 1"];
                correct = 0;
            } else {
                question = "Pak, saya kurang paham dengan materi ini...";
                options = ["Saya akan jelaskan lagi", "Pelajari sendiri", "Tanya teman", "Lewati saja"];
                correct = 0;
            }
            
            document.getElementById('studentQuestionContent').innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="width: 60px; height: 60px; background: ${student.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px;">
                        ${student.emoji}
                    </div>
                    <div>
                        <h3 style="color: ${student.color}; margin: 0;">${student.name}</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">bertanya...</p>
                    </div>
                </div>
                <p style="font-size: 1.2rem; color: #5a3d5c; font-style: italic;">"${question}"</p>
                ${questionType !== "umum" ? `<p style="margin-top: 10px; color: #6bcbff; font-weight: 600;">üìö Topik: ${questionType.charAt(0).toUpperCase() + questionType.slice(1)}</p>` : ''}
            `;
            
            const optionsDiv = document.getElementById('studentQuestionOptions');
            optionsDiv.innerHTML = '';
            
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'control-btn';
                button.style.width = '100%';
                button.style.background = 'linear-gradient(145deg, #6bcbff, #0099ff)';
                button.textContent = option;
                button.onclick = () => handleStudentAnswer(index === correct, student);
                optionsDiv.appendChild(button);
            });
            
            document.getElementById('studentQuestionDetailOverlay').style.display = 'flex';
        }

        function handleStudentAnswer(isCorrect, student) {
            document.getElementById('studentQuestionDetailOverlay').style.display = 'none';
            
            if (isCorrect) {
                studentScores[student.name] = Math.min(10, studentScores[student.name] + 0.8);
                gameState.teacherScore += 25; // Bonus lebih besar untuk pertanyaan siswa
                gameState.patience = Math.min(100, gameState.patience + 20);
                gameState.morale += 15;
                
                showNotification(`‚ú® Jawaban tepat! ${student.name} semakin paham! +25 Poin`, "correct");
            } else {
                gameState.patience -= 15;
                studentScores[student.name] = Math.max(0, studentScores[student.name] - 0.5);
                
                showNotification(`üòÖ Jawaban kurang tepat... -15 Kesabaran`, "incorrect");
            }
            
            closeStudentQuestionDetail();
            updateUI();
            updateProgressBars();
        }

        function closeStudentQuestionDetail() {
            document.getElementById('studentQuestionDetailOverlay').style.display = 'none';
            gameState.studentQuestionActive = false;
            gameState.askingStudent = null;
            
            updateStudentList();
            
            if (gameState.gameActive) {
                startTimer();
            }
        }

        // ========================
        // UI UPDATES
        // ========================
        function updateUI() {
            // Update day and topic
            document.getElementById('dayNumber').textContent = gameState.currentDay;
            const topics = ["Permutasi & Kombinasi", "Peluang", "Limit Fungsi", "UJIAN NASIONAL"];
            document.getElementById('topicDisplay').textContent = `üìö ${topics[gameState.currentDay - 1]}`;
            
            // Update stats
            document.getElementById('patienceValue').textContent = `${gameState.patience}%`;
            document.getElementById('moraleValue').textContent = gameState.morale;
            document.getElementById('totalCorrectDisplay').textContent = `${gameState.totalCorrectAllDays}/20`;
            document.getElementById('teacherScore').textContent = gameState.teacherScore;
            
            // Calculate average
            const average = gameState.totalQuestionsAllDays > 0 ? 
                Math.round((gameState.totalCorrectAllDays / gameState.totalQuestionsAllDays) * 100) : 0;
            document.getElementById('averageScore').textContent = `${average}%`;
            
            // Update teacher status
            const status = document.getElementById('teacherStatus');
            if (gameState.patience < 30) {
                status.textContent = "Stres üò´";
                status.style.color = "#FF5252";
            } else if (gameState.patience < 60) {
                status.textContent = "Lelah üòì";
                status.style.color = "#FF9800";
            } else if (gameState.patience < 80) {
                status.textContent = "Baik üòä";
                status.style.color = "#4CAF50";
            } else {
                status.textContent = "Sangat Baik üòÑ";
                status.style.color = "#2E7D32";
            }
            
            updateProgressBars();
            updateRanking();
        }

        function updateProgressBars() {
            // Patience bar
            const patienceBar = document.getElementById('patienceBar');
            patienceBar.style.width = `${gameState.patience}%`;
            
            // Update bar color based on value
            if (gameState.patience < 30) {
                patienceBar.style.background = 'linear-gradient(90deg, #ff5252, #ff6b6b)';
            } else if (gameState.patience < 60) {
                patienceBar.style.background = 'linear-gradient(90deg, #ff9800, #ffb347)';
            } else {
                patienceBar.style.background = 'linear-gradient(90deg, #ff9acd, #ff6ba9)';
            }
            
            // Correctness bar
            const correctnessBar = document.getElementById('correctnessBar');
            const correctness = (gameState.totalCorrectAllDays / 20) * 100;
            correctnessBar.style.width = `${correctness}%`;
        }

        function updateRanking() {
            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = '';
            
            // Sort students by score
            const sortedStudents = [...students].sort((a, b) => 
                studentScores[b.name] - studentScores[a.name]
            );
            
            sortedStudents.forEach((student, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = 'ranking-item';
                
                rankItem.innerHTML = `
                    <div class="ranking-position">${index + 1}</div>
                    <div class="ranking-name">${student.name}</div>
                    <div class="ranking-score">${studentScores[student.name].toFixed(1)}K</div>
                `;
                
                rankItem.onclick = () => {
                    showNotification(`üëã ${student.name}: ${studentScores[student.name].toFixed(1)}K pemahaman`, "correct");
                };
                
                rankingList.appendChild(rankItem);
            });
        }

        // ========================
        // DAY PROGRESSION
        // ========================
        function endDay() {
            gameState.gameActive = false;
            stopTimer();
            
            const questions = questionsData[`day${gameState.currentDay}`];
            const dayScore = Math.round((gameState.correctAnswers / questions.length) * 100);
            gameState.teacherScore += dayScore;
            
            // Tambah bonus berdasarkan pertanyaan siswa yang dijawab
            const studentQuestionBonus = gameState.studentQuestionCount * 10;
            gameState.teacherScore += studentQuestionBonus;
            
            // Update day complete overlay
            document.getElementById('dayCorrectAnswers').textContent = gameState.correctAnswers;
            document.getElementById('totalCorrectSoFar').textContent = `${gameState.totalCorrectAllDays}/20`;
            document.getElementById('dayScore').textContent = dayScore + studentQuestionBonus;
            
            // Show celebration dengan statistik pertanyaan siswa
            let celebrationMsg = `üéâ Hari ${gameState.currentDay} selesai! Skor: ${dayScore}`;
            if (studentQuestionBonus > 0) {
                celebrationMsg += ` (+${studentQuestionBonus} bonus pertanyaan siswa)`;
            }
            showNotification(celebrationMsg, "correct");
            
            // Reset for next day
            gameState.questionsAnswered = 0;
            gameState.correctAnswers = 0;
            gameState.studentQuestionCount = 0;
            
            // Show day complete overlay
            setTimeout(() => {
                document.getElementById('dayCompleteOverlay').style.display = 'flex';
            }, 1000);
        }

        function autoNextDay() {
            document.getElementById('dayCompleteOverlay').style.display = 'none';
            
            if (gameState.currentDay >= 3) {
                // Go to exam
                gameState.currentDay = 4;
                updateUI();
                setTimeout(() => {
                    startExamDay();
                }, 1500);
            } else {
                // Go to next day
                gameState.currentDay++;
                updateUI();
                
                // Reset question counter
                gameState.currentQuestion = 0;
                
                // Update question text
                document.getElementById('questionText').textContent = 
                    `Hari ${gameState.currentDay} dimulai! Siap untuk materi baru? ‚ú®`;
                
                // Show start day popup automatically
                setTimeout(() => {
                    showStartDayPopup();
                }, 500);
            }
        }

        // ========================
        // EXAM DAY
        // ========================
        function startExamDay() {
            gameState.examActive = true;
            
            // Hide main grid and controls
            document.querySelector('.main-grid').style.display = 'none';
            document.querySelector('.game-controls').style.display = 'none';
            
            // Calculate exam results
            calculateExamResults();
            
            // Show exam overlay
            document.getElementById('examOverlay').style.display = 'flex';
            
            // Show notification
            showNotification("üéì Ujian Nasional dimulai! Ini hari penentuan!", "correct");
        }

        function calculateExamResults() {
            // Calculate based on teaching quality
            const teachingQuality = Math.min(1, gameState.totalCorrectAllDays / 20);
            
            // Average score
            let avgScore = 50 + (teachingQuality * 30) + (Math.random() * 20 - 10);
            avgScore = Math.max(0, Math.min(100, avgScore));
            
            // Pass rate
            let passRate = 40 + (teachingQuality * 40) + (Math.random() * 20 - 10);
            passRate = Math.max(0, Math.min(100, passRate));
            
            // Risk level
            let riskLevel = 60 - (teachingQuality * 40) + (Math.random() * 20 - 10);
            riskLevel = Math.max(0, Math.min(100, riskLevel));
            
            // Update display
            document.getElementById('examAvgScore').textContent = avgScore.toFixed(1);
            document.getElementById('examPassRate').textContent = `${Math.round(passRate)}%`;
            document.getElementById('examRisk').textContent = `${Math.round(riskLevel)}%`;
            
            // Store for final result
            gameState.examResults = { avgScore, passRate, riskLevel };
        }

        function finishExam() {
            document.getElementById('examOverlay').style.display = 'none';
            
            const results = gameState.examResults;
            let passed = false;
            let message = "";
            
            // Determine result
            if (gameState.totalCorrectAllDays >= gameState.requiredCorrect && results.passRate >= 70) {
                passed = true;
                message = `
                    <div style="text-align: center;">
                        <div style="font-size: 5rem; margin: 20px 0;">üéâ</div>
                        <h3 style="color: #4CAF50;">SELAMAT!</h3>
                        <p>Anda berhasil menjadi guru terbaik!</p>
                        <p><strong>${gameState.totalCorrectAllDays}/20</strong> jawaban benar</p>
                        <p><strong>${Math.round(results.passRate)}%</strong> siswa lulus</p>
                        <p><strong>‚≠ê Skor Akhir: ${gameState.teacherScore}</strong></p>
                    </div>
                `;
            } else {
                message = `
                    <div style="text-align: center;">
                        <div style="font-size: 5rem; margin: 20px 0;">üò¢</div>
                        <h3 style="color: #FF5252;">ANDA DIPECAT!</h3>
                        <p>Kinerja mengajar belum memenuhi standar.</p>
                        <p>Hanya <strong>${gameState.totalCorrectAllDays}/20</strong> jawaban benar</p>
                        <p>Minimal diperlukan: <strong>12/20</strong></p>
                    </div>
                `;
            }
            
            // Update high scores
            if (gameState.teacherScore > highScore) {
                highScore = gameState.teacherScore;
                localStorage.setItem('mathTeacherHighScore', highScore);
            }
            
            if (gameState.totalCorrectAllDays > bestCorrect) {
                bestCorrect = gameState.totalCorrectAllDays;
                localStorage.setItem('mathTeacherBestCorrect', bestCorrect);
            }
            
            // Show result
            document.getElementById('resultTitle').textContent = passed ? "üéâ SELAMAT ANDA MENANG!" : "üò¢ GAME OVER";
            document.getElementById('resultContent').innerHTML = message + `
                <div style="background: rgba(255, 222, 89, 0.2); padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <h4 style="color: #ff8a00;">üìä Statistik Akhir</h4>
                    <p>üèÜ Skor Tertinggi: ${highScore}</p>
                    <p>‚úÖ Jawaban Benar Terbaik: ${bestCorrect}/20</p>
                    <p>‚≠ê Skor Anda: ${gameState.teacherScore}</p>
                    <p>üìö Total Pertanyaan Dijawab: ${gameState.totalQuestionsAllDays}</p>
                </div>
            `;
            
            document.getElementById('resultOverlay').style.display = 'flex';
        }

        // ========================
        // HELPER FUNCTIONS
        // ========================
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showHelp() {
            const helpText = `üéÆ MATH TEACHER ADVENTURE üéÆ

‚ú® CARA BERMAIN:
1. Popup "Mulai Hari" akan muncul untuk memulai pelajaran
2. Jawab pertanyaan matematika dengan tepat
3. Jika siswa memiliki pertanyaan, popup akan muncul
4. Jaga kesabaran guru di atas 30%
5. Selesaikan semua 4 hari dengan sukses!

üèÜ TUJUAN:
- Jawab minimal 12 dari 20 soal dengan benar
- Hasilkan tingkat kelulusan minimal 70%
- Tidak kehabisan kesabaran

üìö MATERI HARI 1:
- 5 soal Permutasi (memperhatikan urutan)
- 5 soal Kombinasi (tidak memperhatikan urutan)
- Soal akan muncul secara acak!

üéÆ KONTROL:
- Klik jawaban untuk menjawab pertanyaan
- Klik siswa untuk berinteraksi
- Jawab sebelum waktu habis

‚≠ê TIPS:
- Jawab pertanyaan siswa untuk bonus poin besar
- Jaga kesabaran dengan jawaban benar
- Perhatikan jenis soal (Permutasi/Kombinasi)
- Hari 1 adalah kunci kesuksesan!

Skor Tertinggi: ${highScore}
Jawaban Benar Terbaik: ${bestCorrect}/20`;

            alert(helpText);
        }

        function showHighScores() {
            showNotification(`üèÜ Skor Tertinggi: ${highScore} | ‚úÖ Terbaik: ${bestCorrect}/20`, "correct");
        }

        function restartGame() {
            // Reset game state
            gameState.currentDay = 1;
            gameState.currentQuestion = 0;
            gameState.gameActive = false;
            gameState.timerActive = false;
            gameState.questionsAnswered = 0;
            gameState.correctAnswers = 0;
            gameState.totalCorrectAllDays = 0;
            gameState.totalQuestionsAllDays = 0;
            gameState.patience = 100;
            gameState.teacherScore = 0;
            gameState.studentQuestionActive = false;
            gameState.askingStudent = null;
            gameState.examActive = false;
            gameState.morale = 100;
            gameState.studentQuestionCount = 0;
            
            // Reset student scores
            students.forEach(student => {
                studentScores[student.name] = 4.0 + Math.random() * 1.5;
            });
            
            // Acak soal lagi
            shuffleQuestions();
            
            // Reset UI
            document.getElementById('resultOverlay').style.display = 'none';
            document.querySelector('.main-grid').style.display = 'grid';
            document.querySelector('.game-controls').style.display = 'flex';
            
            document.getElementById('questionText').textContent = 
                "Permainan dimulai ulang! Siap untuk petualangan baru? ‚ú®";
            
            // Reset timer display
            document.getElementById('timer').textContent = "‚è∞ 25s";
            document.getElementById('timer').style.background = "linear-gradient(145deg, #ff5252, #ff6b6b)";
            
            // Clear answer grid
            document.getElementById('answerOptions').innerHTML = '';
            
            // Update everything
            updateUI();
            updateStudentList();
            updateProgressBars();
            
            // Clear any existing notifications
            document.getElementById('notification').style.display = 'none';
            
            // Close all popups
            closePopup('startDayPopup');
            closePopup('studentQuestionPopup');
            
            // Show welcome message
            setTimeout(() => {
                showNotification("Selamat datang kembali! Semoga sukses! üéØ", "correct");
                // Show start day popup automatically
                setTimeout(() => {
                    showStartDayPopup();
                }, 1500);
            }, 500);
        }

        // ========================
        // INITIALIZE GAME
        // ========================
        window.onload = initGame;
    </script>
</body>
</html>