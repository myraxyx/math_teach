<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Teacher RPG - Ujian Nasional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0A3323 0%, #839958 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header */
        .game-header {
            background: linear-gradient(90deg, #F7F4D5, #D3968C);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-counter {
            font-size: 24px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
        }

        .topic-display {
            font-size: 20px;
            font-weight: bold;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            padding: 20px;
            min-height: 500px;
        }

        /* Left Column */
        .classroom-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 3px solid #4CAF50;
        }

        .student-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .student-item:hover {
            transform: translateX(5px);
            border-color: #000000;
        }

        /* Center Column */
        .whiteboard-container {
            background: #105666;
            border-radius: 10px;
            padding: 20px;
            color: white;
            position: relative;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.5;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            min-height: 100px;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #000000;
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .answer-btn.correct {
            background: #4CAF50;
            border-color: #388E3C;
        }

        .answer-btn.incorrect {
            background: #642025;
            border-color: #642025;
        }

        .timer {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
        }

        /* Right Column */
        .stats-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-box {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            border: 3px solid;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        /* Controls */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-top: 3px solid #ddd;
        }

        .control-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .btn-start {
            background: #C87D87;
            color: white;
        }

        .btn-next {
            background: #6B7556;
            color: white;
        }

        .btn-help {
            background: #E5BCA9;
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Overlays */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .overlay-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .material-content {
            font-size: 16px;
            line-height: 1.6;
            margin: 20px 0;
        }

        .formula-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #2196F3;
            font-family: 'Cambria Math', serif;
        }

        /* Day 4 Exam Styles */
        .exam-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .exam-option {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }

        .exam-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .exam-option.patrol {
            border-color: #4CAF50;
        }

        .exam-option.roam {
            border-color: #FF9800;
        }

        /* Risk Indicator */
        .risk-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100;
            display: none;
        }

        /* Feedback */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            display: none;
            animation: fadeInOut 3s;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        .feedback.correct {
            background: #4CAF50;
        }

        .feedback.incorrect {
            background: #F44336;
        }
    </style>
</head>
<body>
    <!-- Risk Indicator -->
    <div class="risk-indicator" id="riskIndicator">
        üé≤ Risiko: <span id="riskValue">30%</span>
    </div>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <h1>üéì Math Teacher RPG</h1>
            <div class="header-right">
                <div class="day-counter" id="dayCounter">Hari 1/4</div>
                <div class="topic-display" id="topicDisplay">Permutasi & Kombinasi</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Left: Students -->
            <div class="classroom-section">
                <h2>üë®‚Äçüéì Siswa</h2>
                <div id="studentList">
                    <!-- Students will be added here -->
                </div>
            </div>

            <!-- Center: Whiteboard -->
            <div class="whiteboard-container">
                <div class="timer" id="timer">‚è∞ 30s</div>
                <div class="question-text" id="questionText">
                    Selamat datang! Klik "Mulai Hari" untuk memulai pelajaran.
                </div>
                <div class="answer-options" id="answerOptions">
                    <!-- Answer options will be added here -->
                </div>
            </div>

            <!-- Right: Stats -->
            <div class="stats-section">
                <div class="stats-box">
                    <h3>üèÜ Ranking</h3>
                    <div id="rankingList">
                        <!-- Ranking will be added here -->
                    </div>
                </div>
                <div class="stats-box">
                    <h3>üìä Progress</h3>
                    <div>Permutasi: <span id="permutasiProgress">0%</span></div>
                    <div>Kombinasi: <span id="kombinasiProgress">0%</span></div>
                </div>
                <div class="stats-box">
                    <h3>üòä Guru</h3>
                    <div>Kesabaran: <span id="patienceValue">100%</span></div>
                    <div>Semangat: <span id="moraleValue">100</span></div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="game-controls">
            <button class="control-btn btn-start" id="startDayBtn" onclick="startDay()">
                Mulai Hari
            </button>
            <button class="control-btn btn-next" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                Lanjut
            </button>
            <button class="control-btn btn-help" onclick="showHelp()">
                Bantuan
            </button>
        </div>
    </div>

    <!-- Material Overlay -->
    <div class="overlay" id="materialOverlay">
        <div class="overlay-content">
            <h2 id="materialTitle">Materi Hari 1</h2>
            <div class="material-content" id="materialContent">
                <!-- Material will be added here -->
            </div>
            <button class="control-btn btn-start" onclick="continueToQuestions()" style="width: 100%; margin-top: 20px;">
                Lanjut ke Pertanyaan
            </button>
        </div>
    </div>

    <!-- Exam Overlay -->
    <div class="overlay" id="examOverlay">
        <div class="overlay-content">
            <h2>üéì UJIAN NASIONAL - Hari 4</h2>
            <p style="margin: 15px 0;">Hari ini menentukan nasib karir Anda sebagai guru!</p>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;" id="examAvgScore">0.0</div>
                    <div>Rata-rata Nilai</div>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;" id="examPassRate">0%</div>
                    <div>Tingkat Kelulusan</div>
                </div>
                <div style="background: #ffebee; padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;" id="examRisk">0%</div>
                    <div>Risiko Dipecat</div>
                </div>
            </div>
            
            <div class="exam-options">
                <div class="exam-option patrol" onclick="startPatrol()">
                    <h3>üö® Patroli Sekolah</h3>
                    <p>Tangkap siswa bolos dan beri hukuman atau bantuan?</p>
                    <p style="color: #666; margin-top: 10px;">‚è±Ô∏è 30 menit</p>
                </div>
                <div class="exam-option roam" onclick="startRoaming()">
                    <h3>üèÉ‚Äç‚ôÄÔ∏è Jalan-jalan</h3>
                    <p>Beli es krim dan jalan-jalan di sekolah.</p>
                    <p style="color: #666; margin-top: 10px;">‚è±Ô∏è 30 menit</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="control-btn btn-start" onclick="finishExam()">
                    Selesaikan Ujian
                </button>
            </div>
        </div>
    </div>

    <!-- Patrol Overlay -->
    <div class="overlay" id="patrolOverlay">
        <div class="overlay-content">
            <h2>üö® Patroli Sekolah</h2>
            <div id="patrolContent" style="margin: 20px 0;">
                <!-- Patrol content will be added here -->
            </div>
            <div style="text-align: center;">
                <button class="control-btn" onclick="endPatrol()">
                    Kembali ke Ujian
                </button>
            </div>
        </div>
    </div>

    <!-- Roam Overlay -->
    <div class="overlay" id="roamOverlay">
        <div class="overlay-content">
            <h2>üèÉ‚Äç‚ôÄÔ∏è Jalan-jalan</h2>
            <div style="text-align: center; margin: 20px 0;">
                <h3>üç¶ Toko Es Krim</h3>
                <div style="display: flex; justify-content: center; gap: 15px; margin: 15px 0;">
                    <button class="control-btn" style="background: #FFD700;" onclick="buyIceCream('vanilla')">
                        üç® Vanila<br>+10 Semangat
                    </button>
                    <button class="control-btn" style="background: #8B4513; color: white;" onclick="buyIceCream('chocolate')">
                        üç´ Coklat<br>+15 Semangat
                    </button>
                    <button class="control-btn" style="background: #FF69B4;" onclick="buyIceCream('strawberry')">
                        üçì Stroberi<br>+20 Semangat
                    </button>
                </div>
            </div>
            <div style="text-align: center;">
                <p>üí™ Semangat: <span id="moraleDisplay">100</span></p>
                <button class="control-btn" onclick="endRoaming()" style="margin-top: 20px;">
                    Kembali ke Ujian
                </button>
            </div>
        </div>
    </div>

    <!-- Result Overlay -->
    <div class="overlay" id="resultOverlay">
        <div class="overlay-content" id="resultContainer">
            <h2 id="resultTitle">Hasil Ujian</h2>
            <div id="resultMessage" style="margin: 20px 0;">
                <!-- Result message will be added here -->
            </div>
            <div style="text-align: center;">
                <button class="control-btn" onclick="restartGame()">
                    Main Lagi
                </button>
            </div>
        </div>
    </div>

    <!-- Feedback -->
    <div class="feedback" id="feedback"></div>

    <script>
        // ========================
        // GAME STATE
        // ========================
        const gameState = {
            currentDay: 1,
            currentQuestion: 0,
            gameActive: false,
            timerActive: false,
            timeLeft: 30,
            timerInterval: null,
            questionsAnswered: 0,
            correctAnswers: 0,
            patience: 100,
            knowledgePoints: 0,
            
            // Day 4 exam state
            examActive: false,
            caughtStudents: [],
            cheatedStudents: [],
            morale: 100,
            riskLevel: 30,
            iceCreamBought: false,
            examResults: []
        };

        // ========================
        // GAME DATA
        // ========================
        const students = ["Wemmbu", "Spoke", "Parrotx2", "Gojo", "Geto", "Flame"];
        const studentScores = {};
        
        // Initialize student scores
        students.forEach(student => {
            studentScores[student] = 4.0 + Math.random() * 1.5;
        });

        const materialData = {
            day1: {
                title: "Hari 1: Permutasi & Kombinasi",
                content: `
                    <h3>‚ú® Pengertian Dasar</h3>
                    <p><strong>Permutasi</strong> adalah cara menyusun objek dengan memperhatikan urutan.</p>
                    <p><strong>Kombinasi</strong> adalah cara memilih objek tanpa memperhatikan urutan.</p>
                    
                    <div class="formula-box">
                        <p><strong>Permutasi:</strong> P(n,r) = n! / (n-r)!</p>
                        <p><strong>Kombinasi:</strong> C(n,r) = n! / [r!(n-r)!]</p>
                        <p>Dimana n = total objek, r = objek yang dipilih</p>
                    </div>
                    
                    <h3>üéØ Contoh</h3>
                    <p>Permutasi: Susun 5 buku berbeda = 5! = 120 cara</p>
                    <p>Kombinasi: Pilih 3 dari 7 siswa = C(7,3) = 35 cara</p>
                `
            },
            day2: {
                title: "Hari 2: Peluang (Probability)",
                content: `
                    <h3>‚ú® Apa itu Peluang?</h3>
                    <p>Peluang mengukur kemungkinan suatu kejadian terjadi.</p>
                    <p>Nilai antara 0 (mustahil) hingga 1 (pasti).</p>
                    
                    <div class="formula-box">
                        <p><strong>Rumus:</strong> P(A) = n(A) / n(S)</p>
                        <p>P(A) = Peluang kejadian A</p>
                        <p>n(A) = Hasil yang diinginkan</p>
                        <p>n(S) = Total kemungkinan hasil</p>
                    </div>
                    
                    <h3>üéØ Contoh</h3>
                    <p>Peluang angka genap pada dadu: 3/6 = 1/2 = 50%</p>
                    <p>Peluang satu gambar satu angka pada 2 koin: 2/4 = 1/2 = 50%</p>
                `
            },
            day3: {
                title: "Hari 3: Limit Fungsi",
                content: `
                    <h3>‚ú® Apa itu Limit?</h3>
                    <p>Limit menunjukkan nilai yang didekati oleh fungsi saat variabel mendekati nilai tertentu.</p>
                    
                    <div class="formula-box">
                        <p><strong>Notasi:</strong> lim f(x) = L</p>
                        <p>x‚Üíc</p>
                        <p>Artinya: saat x mendekati c, f(x) mendekati L</p>
                    </div>
                    
                    <h3>üéØ Contoh</h3>
                    <p>lim (x¬≤ - 4)/(x - 2) = 4</p>
                    <p>x‚Üí2</p>
                    <p>lim sin(x)/x = 1</p>
                    <p>x‚Üí0</p>
                `
            }
        };

        const questionsData = {
            day1: [
                {
                    question: "Ada 5 buku berbeda, berapa cara menyusunnya?",
                    options: ["5 cara", "25 cara", "120 cara", "625 cara"],
                    correct: 2,
                    explanation: "Permutasi 5 objek: 5! = 120 cara"
                },
                {
                    question: "Dari 7 siswa, pilih 3 pengurus. Berapa cara?",
                    options: ["21 cara", "35 cara", "210 cara", "5040 cara"],
                    correct: 1,
                    explanation: "Kombinasi C(7,3) = 35 cara"
                },
                {
                    question: "Password 3 angka berbeda (0-9), berapa kemungkinan?",
                    options: ["1000", "720", "120", "90"],
                    correct: 1,
                    explanation: "Permutasi 3 angka: 10√ó9√ó8 = 720"
                }
            ],
            day2: [
                {
                    question: "Peluang muncul angka genap pada dadu?",
                    options: ["1/6", "1/3", "1/2", "2/3"],
                    correct: 2,
                    explanation: "Angka genap: 2,4,6 ‚Üí 3/6 = 1/2"
                },
                {
                    question: "Dua koin dilempar, peluang satu gambar satu angka?",
                    options: ["1/4", "1/3", "1/2", "3/4"],
                    correct: 2,
                    explanation: "Kemungkinan: AA, AG, GA, GG ‚Üí 2/4 = 1/2"
                }
            ],
            day3: [
                {
                    question: "lim (x¬≤-4)/(x-2) saat x‚Üí2?",
                    options: ["0", "2", "4", "Tak terhingga"],
                    correct: 2,
                    explanation: "(x-2)(x+2)/(x-2) = x+2 ‚Üí 4"
                },
                {
                    question: "lim sin(x)/x saat x‚Üí0?",
                    options: ["0", "1", "Tak terhingga", "Tidak ada"],
                    correct: 1,
                    explanation: "Limit trigonometri dasar = 1"
                }
            ]
        };

        // ========================
        // CORE GAME FUNCTIONS
        // ========================

        function startDay() {
            if (gameState.currentDay === 4) {
                startExamDay();
                return;
            }
            
            showMaterial();
        }

        function showMaterial() {
            const material = materialData[`day${gameState.currentDay}`];
            document.getElementById('materialTitle').textContent = material.title;
            document.getElementById('materialContent').innerHTML = material.content;
            document.getElementById('materialOverlay').style.display = 'flex';
            document.getElementById('startDayBtn').disabled = true;
        }

        function continueToQuestions() {
            document.getElementById('materialOverlay').style.display = 'none';
            
            gameState.gameActive = true;
            gameState.currentQuestion = 0;
            gameState.timeLeft = 30;
            
            document.getElementById('nextQuestionBtn').disabled = false;
            showQuestion();
            startTimer();
        }

        function showQuestion() {
            if (!gameState.gameActive) return;
            
            const questions = questionsData[`day${gameState.currentDay}`];
            const question = questions[gameState.currentQuestion];
            
            if (!question) {
                endDay();
                return;
            }
            
            document.getElementById('questionText').textContent = question.question;
            
            const answerOptions = document.getElementById('answerOptions');
            answerOptions.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = option;
                button.onclick = () => checkAnswer(index);
                answerOptions.appendChild(button);
            });
        }

        function checkAnswer(selectedIndex) {
            const questions = questionsData[`day${gameState.currentDay}`];
            const question = questions[gameState.currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => btn.disabled = true);
            stopTimer();
            
            const isCorrect = selectedIndex === question.correct;
            
            buttons.forEach((btn, index) => {
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            gameState.questionsAnswered++;
            if (isCorrect) {
                gameState.correctAnswers++;
                gameState.knowledgePoints += 10;
                gameState.patience = Math.min(100, gameState.patience + 5);
                showFeedback("‚úÖ Jawaban Benar! +10 Poin", true);
            } else {
                gameState.patience -= 15;
                showFeedback("‚ùå Jawaban Salah! -15 Kesabaran", false);
            }
            
            updateUI();
            document.getElementById('nextQuestionBtn').disabled = false;
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            const questions = questionsData[`day${gameState.currentDay}`];
            
            if (gameState.currentQuestion >= questions.length) {
                endDay();
                return;
            }
            
            document.getElementById('nextQuestionBtn').disabled = true;
            gameState.timeLeft = 30;
            document.getElementById('timer').textContent = `‚è∞ ${gameState.timeLeft}s`;
            
            showQuestion();
            startTimer();
        }

        function endDay() {
            gameState.gameActive = false;
            stopTimer();
            
            if (gameState.currentDay >= 3) {
                gameState.currentDay++;
                updateUI();
                showFeedback("‚úÖ Semua materi selesai! Siap untuk ujian hari 4!", true);
                setTimeout(() => {
                    startExamDay();
                }, 2000);
            } else {
                gameState.currentDay++;
                updateUI();
                document.getElementById('questionText').textContent = `Hari ${gameState.currentDay-1} selesai! Klik "Mulai Hari" untuk melanjutkan.`;
                document.getElementById('startDayBtn').disabled = false;
                document.getElementById('nextQuestionBtn').disabled = true;
            }
        }

        function startTimer() {
            if (gameState.timerActive) return;
            
            gameState.timerActive = true;
            gameState.timeLeft = 30;
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = `‚è∞ ${gameState.timeLeft}s`;
                
                if (gameState.timeLeft <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timerActive = false;
        }

        function timeUp() {
            stopTimer();
            gameState.patience -= 20;
            showFeedback("‚è∞ Waktu habis! -20 Kesabaran", false);
            
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.disabled = true);
            
            document.getElementById('nextQuestionBtn').disabled = false;
            updateUI();
        }

        function updateUI() {
            document.getElementById('dayCounter').textContent = `Hari ${gameState.currentDay}/4`;
            document.getElementById('topicDisplay').textContent = gameState.currentDay === 4 ? "UJIAN NASIONAL" : 
                gameState.currentDay === 1 ? "Permutasi & Kombinasi" :
                gameState.currentDay === 2 ? "Peluang" : "Limit Fungsi";
            
            document.getElementById('patienceValue').textContent = `${gameState.patience}%`;
            document.getElementById('moraleValue').textContent = gameState.morale;
            
            // Update progress
            const permutasiProgress = Math.min(100, (gameState.correctAnswers / 3) * 100);
            document.getElementById('permutasiProgress').textContent = `${permutasiProgress.toFixed(0)}%`;
            
            const kombinasiProgress = Math.min(100, (gameState.knowledgePoints / 30) * 100);
            document.getElementById('kombinasiProgress').textContent = `${kombinasiProgress.toFixed(0)}%`;
            
            // Update student list
            updateStudentList();
            updateRanking();
        }

        function updateStudentList() {
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <strong>${student}</strong><br>
                    <small>Pemahaman: ${studentScores[student].toFixed(1)}K</small>
                `;
                studentList.appendChild(div);
            });
        }

        function updateRanking() {
            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = '';
            
            const sortedStudents = [...students].sort((a, b) => studentScores[b] - studentScores[a]);
            
            sortedStudents.forEach((student, index) => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                div.innerHTML = `
                    <span>${index + 1}. ${student}</span>
                    <span>${studentScores[student].toFixed(1)}K</span>
                `;
                rankingList.appendChild(div);
            });
        }

        function showFeedback(message, isCorrect) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }

        // ========================
        // DAY 4 EXAM FUNCTIONS
        // ========================

        function startExamDay() {
            gameState.examActive = true;
            gameState.currentDay = 4;
            
            // Calculate exam results
            calculateExamResults();
            
            // Hide main game
            document.querySelector('.main-grid').style.display = 'none';
            document.querySelector('.game-controls').style.display = 'none';
            
            // Show exam overlay
            updateExamStats();
            document.getElementById('examOverlay').style.display = 'flex';
            
            // Show risk indicator
            document.getElementById('riskIndicator').style.display = 'block';
            updateRiskIndicator();
        }

        function calculateExamResults() {
            gameState.examResults = [];
            
            students.forEach(student => {
                // Base score from learning
                let baseScore = (studentScores[student] - 4.0) * 40;
                baseScore = Math.max(0, Math.min(60, baseScore));
                
                // Random variation
                const variation = (Math.random() - 0.5) * 40;
                const examScore = Math.max(0, Math.min(100, baseScore + 40 + variation));
                
                const passed = examScore >= 60;
                const cheating = gameState.cheatedStudents.includes(student);
                
                gameState.examResults.push({
                    student,
                    score: examScore,
                    passed,
                    cheating
                });
            });
        }

        function updateExamStats() {
            const results = gameState.examResults;
            
            // Average score
            const avgScore = results.reduce((sum, r) => sum + r.score, 0) / results.length;
            document.getElementById('examAvgScore').textContent = avgScore.toFixed(1);
            
            // Pass rate
            const passedCount = results.filter(r => r.passed).length;
            const passRate = (passedCount / results.length) * 100;
            document.getElementById('examPassRate').textContent = `${passRate.toFixed(0)}%`;
            
            // Risk
            const cheatingCount = results.filter(r => r.cheating).length;
            const risk = Math.min(100, gameState.riskLevel + (cheatingCount * 15));
            document.getElementById('examRisk').textContent = `${risk.toFixed(0)}%`;
            
            return { avgScore, passRate, risk, cheatingCount };
        }

        function updateRiskIndicator() {
            const stats = updateExamStats();
            document.getElementById('riskValue').textContent = `${stats.risk.toFixed(0)}%`;
        }

        function startPatrol() {
            document.getElementById('examOverlay').style.display = 'none';
            document.getElementById('patrolOverlay').style.display = 'flex';
            
            spawnCaughtStudent();
        }

        function spawnCaughtStudent() {
            const availableStudents = students.filter(s => 
                !gameState.caughtStudents.includes(s) && 
                !gameState.cheatedStudents.includes(s)
            );
            
            const patrolContent = document.getElementById('patrolContent');
            
            if (availableStudents.length === 0) {
                patrolContent.innerHTML = `
                    <p style="text-align: center; padding: 40px;">
                        ‚úÖ Tidak ada siswa yang bolos ujian!
                    </p>
                `;
                return;
            }
            
            const student = availableStudents[Math.floor(Math.random() * availableStudents.length)];
            
            patrolContent.innerHTML = `
                <div style="background: #ffebee; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3>üëÆ Ketahuan Bolos!</h3>
                    <p><strong>${student}</strong> ketahuan bermain di toilet saat ujian.</p>
                    <p>Pemahaman: ${studentScores[student].toFixed(1)}K</p>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="control-btn" style="background: #2196F3;" onclick="sendToBK('${student}')">
                            Kirim ke BK<br><small>Nilai: 0</small>
                        </button>
                        <button class="control-btn" style="background: #FF9800;" onclick="giveCheatSheet('${student}')">
                            Beri Contekan<br><small>Risiko +20%</small>
                        </button>
                    </div>
                </div>
            `;
        }

        function sendToBK(student) {
            gameState.caughtStudents.push(student);
            
            // Set score to 0
            const resultIndex = gameState.examResults.findIndex(r => r.student === student);
            if (resultIndex !== -1) {
                gameState.examResults[resultIndex].score = 0;
                gameState.examResults[resultIndex].passed = false;
            }
            
            showFeedback(`üö® ${student} dikirim BK! Nilai: 0`, false);
            updateRiskIndicator();
            setTimeout(spawnCaughtStudent, 1000);
        }

        function giveCheatSheet(student) {
            gameState.caughtStudents.push(student);
            gameState.cheatedStudents.push(student);
            gameState.riskLevel += 20;
            
            // Boost score
            const resultIndex = gameState.examResults.findIndex(r => r.student === student);
            if (resultIndex !== -1) {
                const boost = 30 + Math.random() * 20;
                gameState.examResults[resultIndex].score = Math.min(100, gameState.examResults[resultIndex].score + boost);
                gameState.examResults[resultIndex].cheating = true;
            }
            
            showFeedback(`üìù ${student} diberi contekan! Risiko +20%`, true);
            updateRiskIndicator();
            setTimeout(spawnCaughtStudent, 1000);
        }

        function endPatrol() {
            document.getElementById('patrolOverlay').style.display = 'none';
            document.getElementById('examOverlay').style.display = 'flex';
            updateExamStats();
        }

        function startRoaming() {
            document.getElementById('examOverlay').style.display = 'none';
            document.getElementById('roamOverlay').style.display = 'flex';
            document.getElementById('moraleDisplay').textContent = gameState.morale;
        }

        function buyIceCream(flavor) {
            if (gameState.iceCreamBought) {
                showFeedback("üç¶ Sudah beli es krim hari ini!", false);
                return;
            }
            
            let boost = 0;
            let message = "";
            
            switch(flavor) {
                case 'vanilla': boost = 10; message = "üç® Vanila segar!"; break;
                case 'chocolate': boost = 15; message = "üç´ Coklat enak!"; break;
                case 'strawberry': boost = 20; message = "üçì Stroberi manis!"; break;
            }
            
            gameState.morale = Math.min(100, gameState.morale + boost);
            gameState.iceCreamBought = true;
            
            document.getElementById('moraleDisplay').textContent = gameState.morale;
            showFeedback(`${message} +${boost} Semangat`, true);
        }

        function endRoaming() {
            document.getElementById('roamOverlay').style.display = 'none';
            document.getElementById('examOverlay').style.display = 'flex';
        }

        function finishExam() {
            const stats = updateExamStats();
            
            // Determine if cheating gets caught
            const cheatingCaught = Math.random() * 100 < stats.risk;
            let finalPassRate = stats.passRate;
            
            if (cheatingCaught) {
                finalPassRate *= 0.7;
            } else if (gameState.cheatedStudents.length > 0) {
                finalPassRate *= 1.2;
            }
            
            // Determine outcome
            const keepJob = finalPassRate >= 70 && !cheatingCaught;
            
            showExamResults(keepJob, cheatingCaught, stats, finalPassRate);
        }

        function showExamResults(keepJob, cheatingCaught, stats, finalPassRate) {
            document.getElementById('examOverlay').style.display = 'none';
            
            const resultContainer = document.getElementById('resultContainer');
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            
            if (keepJob) {
                resultContainer.style.background = '#e8f5e9';
                resultTitle.textContent = "üéâ SELAMAT!";
                resultTitle.style.color = "#2E7D32";
                resultMessage.innerHTML = `
                    <p><strong>Anda tetap menjadi guru!</strong></p>
                    <p>Tingkat kelulusan: ${finalPassRate.toFixed(0)}%</p>
                    ${cheatingCaught ? "<p>Meski ada masalah, kepala sekolah memaafkan Anda.</p>" : 
                      gameState.cheatedStudents.length > 0 ? "<p>Bantuan Anda berhasil tanpa ketahuan!</p>" : 
                      "<p>Siswa lulus dengan kemampuan sendiri.</p>"}
                `;
            } else {
                resultContainer.style.background = '#ffebee';
                resultTitle.textContent = "üò¢ DIPECAT!";
                resultTitle.style.color = "#C62828";
                resultMessage.innerHTML = `
                    <p><strong>Anda dipecat dari sekolah!</strong></p>
                    ${cheatingCaught ? 
                    `<p>‚õî Ketahuan memberi contekan! ${gameState.cheatedStudents.length} siswa ketahuan mencontek.</p>` : 
                    `<p>üìâ Tingkat kelulusan hanya ${finalPassRate.toFixed(0)}%, di bawah standar 70%.</p>`}
                `;
            }
            
            // Add details
            resultMessage.innerHTML += `
                <hr style="margin: 20px 0;">
                <h3>üìä Detail Hasil:</h3>
                <p>Rata-rata nilai: ${stats.avgScore.toFixed(1)}</p>
                <p>Semangat guru: ${gameState.morale}</p>
                ${gameState.cheatedStudents.length > 0 ? `<p>Siswa dibantu: ${gameState.cheatedStudents.join(", ")}</p>` : ''}
            `;
            
            document.getElementById('resultOverlay').style.display = 'flex';
        }

        function restartGame() {
            // Reset game state
            gameState.currentDay = 1;
            gameState.currentQuestion = 0;
            gameState.gameActive = false;
            gameState.timerActive = false;
            gameState.questionsAnswered = 0;
            gameState.correctAnswers = 0;
            gameState.patience = 100;
            gameState.knowledgePoints = 0;
            gameState.examActive = false;
            gameState.caughtStudents = [];
            gameState.cheatedStudents = [];
            gameState.morale = 100;
            gameState.riskLevel = 30;
            gameState.iceCreamBought = false;
            
            // Reset student scores
            students.forEach(student => {
                studentScores[student] = 4.0 + Math.random() * 1.5;
            });
            
            // Hide overlays
            document.getElementById('resultOverlay').style.display = 'none';
            document.getElementById('riskIndicator').style.display = 'none';
            
            // Show main game
            document.querySelector('.main-grid').style.display = 'grid';
            document.querySelector('.game-controls').style.display = 'flex';
            
            // Reset UI
            updateUI();
            document.getElementById('questionText').textContent = "Selamat datang! Klik 'Mulai Hari' untuk memulai.";
            document.getElementById('startDayBtn').disabled = false;
            document.getElementById('nextQuestionBtn').disabled = true;
        }

        function showHelp() {
            alert(`üéÆ CARA BERMAIN:
            
HARI 1-3: MENGAJAR
1. Klik 'Mulai Hari' untuk belajar materi
2. Jawab pertanyaan siswa sebelum waktu habis
3. Tingkatkan pemahaman siswa

HARI 4: UJIAN NASIONAL
1. Pilih PATROLI untuk menangkap siswa bolos
   - Kirim ke BK: Nilai 0, aman
   - Beri contekan: Nilai naik, RISIKO tinggi!
   
2. Pilih JALAN-JALAN untuk beli es krim
   - Tingkatkan semangat guru
   
3. Hasil ujian menentukan nasib karir:
   - Kelulusan > 70% = tetap jadi guru
   - Ketahuan memberi contekan = langsung dipecat!

üí° TIPS:
- Ajarkan dengan baik di hari 1-3
- Hati-hati memberi contekan
- Monitor statistik terus`);
        }

        // Initialize game
        updateUI();
        updateStudentList();
        updateRanking();
    </script>
</body>
</html>